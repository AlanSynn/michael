/*! For license information please see 7852684d096db5f7b36a.js.LICENSE.txt */
function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _regeneratorRuntime(){"use strict";_regeneratorRuntime=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,a=Object.defineProperty||function(e,t,n){e[t]=n.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",l=o.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function d(e,t,n,r){var o=t&&t.prototype instanceof f?t:f,i=Object.create(o.prototype),s=new A(r||[]);return a(i,"_invoke",{value:x(e,n,s)}),i}function u(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=d;var m="suspendedStart",p="suspendedYield",g="executing",y="completed",h={};function f(){}function v(){}function E(){}var b={};c(b,i,(function(){return this}));var w=Object.getPrototypeOf,S=w&&w(w(C([])));S&&S!==n&&r.call(S,i)&&(b=S);var k=E.prototype=f.prototype=Object.create(b);function _(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function T(e,t){function n(a,o,i,s){var l=u(e[a],e,o);if("throw"!==l.type){var c=l.arg,d=c.value;return d&&"object"==_typeof(d)&&r.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,i,s)}),(function(e){n("throw",e,i,s)})):t.resolve(d).then((function(e){c.value=e,i(c)}),(function(e){return n("throw",e,i,s)}))}s(l.arg)}var o;a(this,"_invoke",{value:function(e,r){function a(){return new t((function(t,a){n(e,r,t,a)}))}return o=o?o.then(a,a):a()}})}function x(t,n,r){var a=m;return function(o,i){if(a===g)throw Error("Generator is already running");if(a===y){if("throw"===o)throw i;return{value:e,done:!0}}for(r.method=o,r.arg=i;;){var s=r.delegate;if(s){var l=I(s,r);if(l){if(l===h)continue;return l}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(a===m)throw a=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);a=g;var c=u(t,n,r);if("normal"===c.type){if(a=r.done?y:p,c.arg===h)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(a=y,r.method="throw",r.arg=c.arg)}}}function I(t,n){var r=n.method,a=t.iterator[r];if(a===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,I(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),h;var o=u(a,t.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,h;var i=o.arg;return i?i.done?(n[t.resultName]=i.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,h):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,h)}function L(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function B(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(L,this),this.reset(!0)}function C(t){if(t||""===t){var n=t[i];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,o=function n(){for(;++a<t.length;)if(r.call(t,a))return n.value=t[a],n.done=!1,n;return n.value=e,n.done=!0,n};return o.next=o}}throw new TypeError(_typeof(t)+" is not iterable")}return v.prototype=E,a(k,"constructor",{value:E,configurable:!0}),a(E,"constructor",{value:v,configurable:!0}),v.displayName=c(E,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,E):(e.__proto__=E,c(e,l,"GeneratorFunction")),e.prototype=Object.create(k),e},t.awrap=function(e){return{__await:e}},_(T.prototype),c(T.prototype,s,(function(){return this})),t.AsyncIterator=T,t.async=function(e,n,r,a,o){void 0===o&&(o=Promise);var i=new T(d(e,n,r,a),o);return t.isGeneratorFunction(n)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},_(k),c(k,l,"Generator"),c(k,i,(function(){return this})),c(k,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=C,A.prototype={constructor:A,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(B),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function a(r,a){return s.type="throw",s.arg=t,n.next=r,a&&(n.method="next",n.arg=e),!!a}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],s=i.completion;if("root"===i.tryLoc)return a("end");if(i.tryLoc<=this.prev){var l=r.call(i,"catchLoc"),c=r.call(i,"finallyLoc");if(l&&c){if(this.prev<i.catchLoc)return a(i.catchLoc,!0);if(this.prev<i.finallyLoc)return a(i.finallyLoc)}else if(l){if(this.prev<i.catchLoc)return a(i.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return a(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&r.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,h):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),B(n),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var a=r.arg;B(n)}return a}}throw Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:C(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),h}},t}function asyncGeneratorStep(e,t,n,r,a,o,i){try{var s=e[o](i),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,a)}function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){asyncGeneratorStep(o,r,a,i,s,"next",e)}function s(e){asyncGeneratorStep(o,r,a,i,s,"throw",e)}i(void 0)}))}}import{marked}from"marked";import icon from"../../assets/icon.png";import iconBlack from"../../assets/icon-black.png";import michaelBlackLogo from"../../assets/michael-black.png";import michaelWhiteLogo from"../../assets/michael-white.png";import meetMichaelBlackLogo from"../../assets/meet-michael-black.png";import meetMichaelWhiteLogo from"../../assets/meet-michael-white.png";var safetySettings=[{category:"HARM_CATEGORY_HARASSMENT",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_HATE_SPEECH",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_SEXUALLY_EXPLICIT",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_DANGEROUS_CONTENT",threshold:"BLOCK_NONE"}],TYPES={SUMMARIZE:0,TRANSLATE:1,TRANSLATE_SUMMARIZE:2,REPLY:3,CALENDAR:4},DEFAULT_TEMPLATES={summarize:'You are an expert researcher. Your task is to review the provided research document and complete the following tasks with academic depth and varied sentence structures:\n\n1. Summarize the Research Background:\n   - Provide a concise yet comprehensive summary of the study\'s background, including its context and motivation.\n\n2. Extract the Problem Statement:\n   - Clearly identify and articulate the central problem or challenge addressed by the research.\n\n3. Identify Strengths:\n   - List 3–5 key strengths of the study, focusing on aspects such as methodology, innovation, robustness of results, or any other notable positive attributes.\n\n4. Identify Weaknesses:\n   - Enumerate 4–5 significant weaknesses or limitations present in the research, considering issues like methodological gaps, limited scope, or areas lacking clarity.\n\n5. Propose Research Topics:\n   - Based on the weaknesses identified, suggest three potential research topics that could address these limitations or explore related areas further.\n\n6. Include a "tl;dr" Section:\n   - At the very top of your response, provide a succinct "tl;dr" summary without any syntax highlighting that encapsulates the main points and any necessary takeaways.\n\nDo not include any extraneous messages, introductions, or commentary. Your final output should strictly adhere to these instructions.\n\nSubject: {subject}\nContent:\n{content}',translate:"You are an expert translator and interpreter with extensive proficiency in various languages, specializing in translating texts into polished, academic Korean. Your task is to translate the provided text from the source language into Korean, ensuring that every nuance, stylistic detail, and analytical aspect is accurately and naturally conveyed. Please follow these guidelines:\n\nPreserve Nuance and Style:\n- Accurately reflect the original text's tone, emotional nuance, and stylistic characteristics in Korean.\n- Adapt idiomatic expressions, metaphors, and culturally specific references to ensure they resonate with Korean readers.\n\nMaintain Analytical Precision:\n- Carefully dissect complex sentences and ideas, ensuring that your translation maintains the original text's logical flow and depth of analysis.\n- Where necessary, integrate brief annotations or contextual clarifications to help convey any cultural or conceptual subtleties.\n\nEnsure Accuracy and Consistency:\n- Translate specialized vocabulary, technical terms, and academic language with precision and maintain consistency throughout the text.\n- Verify that the structure and argumentative progression of the source material are preserved in the Korean version.\n\nUphold Contextual Integrity:\n- Ensure that the overall message and intent of the original text are fully maintained in your translation.\n- Make sure that transitions between ideas and sections remain coherent and logically connected in Korean.\n\nReview and Refine:\n- Reassess your translation for any potential ambiguities or loss of nuance, refining as necessary to enhance clarity and precision.\n- Strive for a balanced outcome that honors the original text while ensuring the translation is engaging and accessible to a Korean audience.\n\nProvide tl;dr at the top:\nWrite a tl;dr section at the top of your response that summarizes the main points and todos if needed.\n\nDeliver your final translation in refined, academic Korean that faithfully embodies the original text's analytical and stylistic essence.\n\nSubject: {subject}\n\nContent:\n{content}",translateSummarize:"You are an expert translator and summarizer with extensive proficiency in various languages, specializing in translating texts into polished, academic Korean. Your task is to translate the provided text from the source language into Korean AND create a concise summary of the main points. Please follow these guidelines:\n\nTranslation Aspects:\n- Accurately reflect the original text's tone, emotional nuance, and stylistic characteristics in Korean.\n- Adapt idiomatic expressions, metaphors, and culturally specific references to ensure they resonate with Korean readers.\n- Maintain analytical precision and logical flow in the Korean translation.\n\nSummarization Requirements:\n- Create a concise and focused summary of the key points in Korean.\n- Prioritize clarity and brevity while maintaining the essential meaning.\n- Ensure the summary captures the main ideas, arguments, and conclusions.\n- Limit the summary to approximately 30-40% of the original length.\n\nFinal Delivery Format:\n1. First provide tl;dr at the top:\nWrite a tl;dr section at the top of your response that summarizes the main points and todos if needed.\n2. Then provide a concise summary section (제목: 요약)\n3. Then provide the full translation (제목: 전체 번역)\n\nSubject: {subject}\n\nContent:\n{content}",reply:"You are an expert assistant that can help me with my email. I will provide you with the email content and you will help me with the following tasks:\n\n  Write a reply to the email.\n\n  Subject: {subject}\n\n  Content:\n  {content}\n  in {language}",tldrPrompt:"Please provide a very concise summary in {language} of the following content. Focus on the main points and key takeaways. Do not include any extraneous messages, introductions, or commentary. Your final output should strictly adhere to these instructions.\n\n  Subject: {subject}\n\n  Content:\n  {content}"};function toggleSettingsDropdown(){var e=document.getElementById("settings-dropdown");if(e){var t="block"===e.style.display;e.style.display=t?"none":"block"}}function applyCurrentTheme(){var e=localStorage.getItem("theme")||"dark";if("light"===e)document.body.setAttribute("data-theme","light"),document.body.classList.remove("dark-theme");else if("dark"===e)document.body.setAttribute("data-theme","dark"),document.body.classList.add("dark-theme");else if(Office.context.officeTheme){var t=Office.context.officeTheme.bodyBackgroundColor;t?isDarkTheme(t)?(document.body.setAttribute("data-theme","dark"),document.body.classList.add("dark-theme")):(document.body.setAttribute("data-theme","light"),document.body.classList.remove("dark-theme")):(document.body.setAttribute("data-theme","dark"),document.body.classList.add("dark-theme"))}var n=document.getElementById("sideload-logo"),r=document.getElementById("landing-logo-main"),a=document.getElementById("brand-logo"),o=document.body.classList.contains("dark-theme")?meetMichaelWhiteLogo:meetMichaelBlackLogo,i=document.body.classList.contains("dark-theme")?michaelWhiteLogo:michaelBlackLogo,s=document.body.classList.contains("dark-theme")?icon:iconBlack;n&&(n.src=s),r&&(r.src=o),a&&(a.src=i)}function isDarkTheme(e){if(!e||"string"!=typeof e)return!1;try{e=e.replace("#","");var t=parseInt(e.substr(0,2),16),n=parseInt(e.substr(2,2),16),r=parseInt(e.substr(4,2),16);return!(isNaN(t)||isNaN(n)||isNaN(r))&&.299*t+.587*n+.114*r<128}catch(e){return console.error("Error calculating theme brightness:",e),!1}}function onSettingsChanged(e){"system"===(localStorage.getItem("theme")||"system")&&applyCurrentTheme()}function showNotification(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",n=document.getElementById("notification");n&&n.remove();var r=document.createElement("div");r.id="notification",r.className="notification ".concat(t),r.textContent=e,document.body.appendChild(r),r.offsetHeight,r.style.animation="slideInFromTop 0.3s ease-out",setTimeout((function(){r.style.animation="slideOutToTop 0.3s ease-out",setTimeout((function(){r.remove()}),300)}),3e3)}function saveDropdownSettings(){var e={};try{var t=localStorage.getItem("my_sidekick_michael_settings");t&&(e=JSON.parse(t))}catch(e){console.error("Error parsing settings:",e)}var n=document.getElementById("dropdown-api-key").value,r=document.getElementById("dropdown-model").value,a=document.getElementById("dropdown-language").value,o=document.getElementById("dropdown-event-title-language").value,i=document.getElementById("dropdown-theme").value,s=document.getElementById("dropdown-font-size").value,l=document.getElementById("dropdown-tldr-mode").value,c=document.getElementById("dropdown-show-reply").value,d=document.getElementById("dropdown-reply-template").value,u=document.getElementById("dropdown-autorun").value,m=document.getElementById("dropdown-autorun-option").value,p=document.getElementById("dropdown-dev-mode").value,g=document.getElementById("dropdown-dev-server").value,y=document.getElementById("dropdown-summarize-template").value,h=document.getElementById("dropdown-translate-template").value,f=document.getElementById("dropdown-translate-summarize-template").value;e.apiKey=n,e.model=r,e.defaultLanguage=a,e.eventTitleLanguage=o,e.theme=i,e.fontSize=s,e.tldrMode=l,e.showReply=c,e.replyModel=d,e.autorun=u,e.autorunOption=m,e.devMode=p,e.devServer=g,e.templates||(e.templates={}),e.templates.summarize=y,e.templates.translate=h,e.templates.translateSummarize=f,e.templates.reply=d,localStorage.setItem("my_sidekick_michael_settings",JSON.stringify(e)),n?localStorage.setItem("my_sidekick_michael_api_key",n):localStorage.removeItem("my_sidekick_michael_api_key"),localStorage.setItem("theme",i),applyCurrentTheme(),applyFontSize(s),updateReplyButtonVisibility("true"===c),updateDevBadges("true"===p),showNotification("All settings saved successfully"),toggleSettingsDropdown()}function resetTemplates(){var e=localStorage.getItem("my_sidekick_michael_settings"),t=e?JSON.parse(e):{};t.templates=DEFAULT_TEMPLATES,localStorage.setItem("my_sidekick_michael_settings",JSON.stringify(t)),document.getElementById("dropdown-summarize-template").value=DEFAULT_TEMPLATES.summarize,document.getElementById("dropdown-translate-template").value=DEFAULT_TEMPLATES.translate,document.getElementById("dropdown-translate-summarize-template")&&(document.getElementById("dropdown-translate-summarize-template").value=DEFAULT_TEMPLATES.translateSummarize),document.getElementById("dropdown-reply-template")&&(document.getElementById("dropdown-reply-template").value=DEFAULT_TEMPLATES.reply),showNotification("Templates reset to defaults")}function loadDropdownSettings(){try{var e=localStorage.getItem("my_sidekick_michael_settings"),t=localStorage.getItem("my_sidekick_michael_api_key");if(e){var n=JSON.parse(e);n.apiKey&&(document.getElementById("dropdown-api-key").value=n.apiKey),n.model&&(document.getElementById("dropdown-model").value=n.model),n.defaultLanguage&&(document.getElementById("dropdown-language").value=n.defaultLanguage),n.eventTitleLanguage&&(document.getElementById("dropdown-event-title-language").value=n.eventTitleLanguage),n.theme&&(document.getElementById("dropdown-theme").value=n.theme),n.fontSize&&(document.getElementById("dropdown-font-size").value=n.fontSize),n.tldrMode&&(document.getElementById("dropdown-tldr-mode").value=n.tldrMode),n.showReply&&(document.getElementById("dropdown-show-reply").value=n.showReply),n.devServer&&(document.getElementById("dropdown-dev-server").value=n.devServer);var r=document.getElementById("dev-server-group");r&&(r.style.display="true"===n.devMode?"block":"none"),updateDevBadges("true"===n.devMode),n.fontSize&&applyFontSize(n.fontSize),n.showReply&&updateReplyButtonVisibility("true"===n.showReply),n.templates?(document.getElementById("dropdown-summarize-template").value=n.templates.summarize||DEFAULT_TEMPLATES.summarize,document.getElementById("dropdown-translate-template").value=n.templates.translate||DEFAULT_TEMPLATES.translate,document.getElementById("dropdown-translate-summarize-template").value=n.templates.translateSummarize||DEFAULT_TEMPLATES.translateSummarize,document.getElementById("dropdown-reply-template").value=n.templates.reply||DEFAULT_TEMPLATES.reply):resetTemplates()}else resetTemplates();t&&(document.getElementById("dropdown-api-key").value=t)}catch(e){console.error("Error loading dropdown settings:",e),resetTemplates()}}function applyFontSize(e){document.documentElement.setAttribute("data-font-size",e||"medium")}function getEmailContent(){return _getEmailContent.apply(this,arguments)}function _getEmailContent(){return(_getEmailContent=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,t){Office.context.mailbox.item.body.getAsync("text",(function(n){n.status===Office.AsyncResultStatus.Succeeded?e(n.value):t(new Error("Failed to get email content"))}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function generateContent(e,t){return _generateContent.apply(this,arguments)}function _generateContent(){return _generateContent=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,n){var r,a,o,i,s,l,c,d,u,m,p=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=p.length>3&&void 0!==p[3]&&p[3],o="gemini-2.0-flash-light",r=p.length>2&&void 0!==p[2]?p[2]:null)o=r;else try{(i=localStorage.getItem("my_sidekick_michael_settings"))&&(s=JSON.parse(i)).model&&(o=s.model)}catch(e){console.error("Error getting model from settings:",e)}return l="https://generativelanguage.googleapis.com/v1beta/models/".concat(o,":generateContent?key=").concat(n),e.prev=5,e.next=8,fetch(l,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:t}]}],generationConfig:{temperature:.4,topK:32,topP:.95,maxOutputTokens:a?800:8192},safetySettings:safetySettings})});case 8:return c=e.sent,e.next=11,c.json();case 11:if(d=e.sent,c.ok){e.next=14;break}throw new Error((null===(u=d.error)||void 0===u?void 0:u.message)||"Error generating content");case 14:if(d.candidates&&0!==d.candidates.length){e.next=16;break}throw new Error("No content generated");case 16:return m=d.candidates[0].content.parts[0].text,e.abrupt("return",m);case 20:throw e.prev=20,e.t0=e.catch(5),console.error("Error generating content:",e.t0),e.t0;case 24:return e.prev=24,a||(document.getElementById("loading").style.display="none"),e.finish(24);case 27:case"end":return e.stop()}}),e,null,[[5,20,24,27]])}))),_generateContent.apply(this,arguments)}function generateTldrContent(e,t){return _generateTldrContent.apply(this,arguments)}function _generateTldrContent(){return _generateTldrContent=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,n){var r,a,o,i,s,l,c=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=c.length>2&&void 0!==c[2]?c[2]:"Korean",a=c.length>3&&void 0!==c[3]?c[3]:null,o=Office.context.mailbox.item.subject,e.next=5,getEmailContent();case 5:return i=e.sent,s=DEFAULT_TEMPLATES.tldrPrompt.replace("{subject}",o).replace("{content}",i).replace("{language}",r),e.next=9,generateContent(s,n,a,!0);case 9:return l=e.sent,e.abrupt("return",l);case 11:case"end":return e.stop()}}),e)}))),_generateTldrContent.apply(this,arguments)}function getLanguageText(e){switch(e){case"es":return"Spanish";case"fr":return"French";case"de":return"German";case"it":return"Italian";case"ja":return"Japanese";case"ko":return"Korean";case"zh_cn":return"Chinese";default:return"English"}}function getApiKey(){return localStorage.getItem("my_sidekick_michael_api_key")}function getLanguage(){try{var e=localStorage.getItem("my_sidekick_michael_settings");if(e){var t=JSON.parse(e);if(t.defaultLanguage)return t.defaultLanguage}return"ko"}catch(e){return console.error("Error getting language:",e),"ko"}}function summarizeEmail(){return _summarizeEmail.apply(this,arguments)}function _summarizeEmail(){return(_summarizeEmail=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,n,r,a,o,i,s,l,c,d,u;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=getApiKey()){e.next=5;break}return showNotification("Please add your Gemini API key in the settings","error"),toggleSettingsDropdown(),e.abrupt("return");case 5:return showLoading("Summarizing email..."),e.prev=6,e.next=9,getEmailContent();case 9:n=e.sent,r=Office.context.mailbox.item.subject,a=DEFAULT_TEMPLATES.summarize;try{(o=localStorage.getItem("my_sidekick_michael_settings"))&&(i=JSON.parse(o)).templates&&i.templates.summarize&&(a=i.templates.summarize)}catch(e){console.error("Error getting template:",e)}s=a.replace("{subject}",r).replace("{content}",n),l=!0;try{(c=localStorage.getItem("my_sidekick_michael_settings"))&&(d=JSON.parse(c)).tldrMode&&(l="true"===d.tldrMode)}catch(e){console.error("Error getting TLDR mode setting:",e)}if(!l){e.next=29;break}return e.next=19,generateTldrContent(s,t,"English");case 19:return u=e.sent,hideLoading(),showResults(u,TYPES.SUMMARIZE),e.next=24,generateContent(s,t);case 24:updateResults(e.sent),updateExpandButton(!0),e.next=33;break;case 29:return e.next=31,generateContent(s,t);case 31:showResults(e.sent,TYPES.SUMMARIZE);case 33:e.next=38;break;case 35:e.prev=35,e.t0=e.catch(6),showNotification("Error: ".concat(e.t0.message),"error");case 38:case"end":return e.stop()}}),e,null,[[6,35]])})))).apply(this,arguments)}function translateEmail(){return _translateEmail.apply(this,arguments)}function _translateEmail(){return(_translateEmail=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,n,r,a,o,i,s,l,c,d,u,m;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=getApiKey(),n=getLanguage(),t){e.next=6;break}return showNotification("Please add your Gemini API key in the settings","error"),toggleSettingsDropdown(),e.abrupt("return");case 6:return showLoading("Translating to "+getLanguageText(n)+"..."),e.prev=7,e.next=10,getEmailContent();case 10:r=e.sent,a=Office.context.mailbox.item.subject,o=DEFAULT_TEMPLATES.translate;try{(i=localStorage.getItem("my_sidekick_michael_settings"))&&(s=JSON.parse(i)).templates&&s.templates.translate&&(o=s.templates.translate)}catch(e){console.error("Error getting template:",e)}l=o.replace("{subject}",a).replace("{content}",r),c=!0;try{(d=localStorage.getItem("my_sidekick_michael_settings"))&&(u=JSON.parse(d)).tldrMode&&(c="true"===u.tldrMode)}catch(e){console.error("Error getting TLDR mode setting:",e)}if(!c){e.next=30;break}return e.next=20,generateTldrContent(l,t,n);case 20:return m=e.sent,hideLoading(),showResults(m,TYPES.TRANSLATE),e.next=25,generateContent(l,t);case 25:updateResults(e.sent),updateExpandButton(!0),e.next=34;break;case 30:return e.next=32,generateContent(l,t,n);case 32:showResults(e.sent,TYPES.TRANSLATE);case 34:e.next=39;break;case 36:e.prev=36,e.t0=e.catch(7),showNotification("Error: ".concat(e.t0.message),"error");case 39:case"end":return e.stop()}}),e,null,[[7,36]])})))).apply(this,arguments)}function updateExpandButton(e){var t=document.getElementById("expand-content");t&&(t.disabled=!e,t.classList.toggle("ms-Button--disabled",!e),t.innerHTML=e?"Show Full Content":"Hide Full Content",t.classList.toggle("ms-Button--primary",e))}function copyResult(){var e="",t=document.getElementById("tldr-content").innerText,n=document.getElementById("result-content").innerText;if(t.includes("Subject:")||n.includes("Subject:")){var r="",a="",o=/^(?:Subject:\s*)?(.+?)(?:\n|$)/i.exec(t);o&&(r=o[1].trim()),a="none"!==document.getElementById("full-content-container").style.display?n:o?t.split("\n").slice(1).join("\n").trim():t,e="Subject: ".concat(r,"\n\n").concat(a)}else e="none"!==document.getElementById("full-content-container").style.display?n:t;navigator.clipboard.writeText(e).then((function(){var e=document.getElementById("copy-status");e.textContent="Copied!",setTimeout((function(){e.textContent=""}),2e3)})).catch((function(e){console.error("Could not copy text: ",e),showNotification("Failed to copy to clipboard","error")}))}function markdownToHtml(e){if(!e)return"";var t="medium";try{var n=localStorage.getItem("my_sidekick_michael_settings");if(n){var r=JSON.parse(n);r.fontSize&&(t=r.fontSize)}}catch(e){console.error("Error getting font size:",e)}var a="small"===t?"13px":"large"===t?"18px":"16px",o="small"===t?"1.5":"large"===t?"1.7":"1.6",i="small"===t?"13px":"large"===t?"17px":"15px",s=/^#\s+(?:Re:|Subject:|\[Reply\]|Response:)/i.test(e);return e.replace(/^#\s+(.*$)/gim,(function(e,t){return s?'<h1 class="reply-heading">'.concat(t,"</h1>"):"<h1>".concat(t,"</h1>")})).replace(/^###\s+(.*$)/gim,"<h3>$1</h3>").replace(/^##\s+(.*$)/gim,"<h2>$1</h2>").replace(/\*\*(.*?)\*\*/gim,'<strong style="font-weight: 700;">$1</strong>').replace(/\*(.*?)\*/gim,'<em style="font-style: italic;">$1</em>').replace(/\_\_([^_]+)\_\_/gim,'<strong style="font-weight: 700;">$1</strong>').replace(/\_([^_]+)\_/gim,'<em style="font-style: italic;">$1</em>').replace(/^\s*\n\* (.*)/gim,'<ul class="no-indent">\n<li>$1</li>').replace(/^\* (.*)/gim,"<li>$1</li>").replace(/^\s*\n\d+\. (.*)/gim,'<ol class="no-indent">\n<li>$1</li>').replace(/^\d+\. (.*)/gim,"<li>$1</li>").replace(/^\> (.*$)/gim,'<blockquote style="border-left: 4px solid var(--accent-color); padding-left: 1em; margin: 1em 0; background-color: rgba(0,0,0,0.03);">$1</blockquote>').replace(/```([\s\S]*?)```/gim,'<pre style="background-color: var(--code-background); padding: 12px; border-radius: 5px; overflow-x: auto; border: 1px solid var(--border-color);"><code style="font-family: \'Courier New\', Courier, monospace; font-size: '+i+';">$1</code></pre>').replace(/`([^`]+)`/gim,"<code style=\"background-color: var(--code-background); padding: 3px 5px; border-radius: 3px; font-family: 'Courier New', Courier, monospace; font-size: "+i+'; font-weight: 500;">$1</code>').replace(/^\-\-\-$/gim,'<hr style="height: 2px; background-color: var(--border-color); border: 0; margin: 1.5em 0;">').replace(/\[([^\]]+)\]\(([^)]+)\)/gim,'<a href="$2" target="_blank" style="color: var(--accent-color); text-decoration: none; font-weight: bold;">$1</a>').replace(/\n\s*\n/gim,'</p><p style="margin: 0.8em 0; font-size: '+a+"; line-height: "+o+';">').replace(/\n/gim,"<br>").replace(/^(.+)$/gim,'<p style="margin: 0.8em 0; font-size: '+a+"; line-height: "+o+';">$1</p>')}function translateAndSummarizeEmail(){return _translateAndSummarizeEmail.apply(this,arguments)}function _translateAndSummarizeEmail(){return(_translateAndSummarizeEmail=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,n,r,a,o,i,s,l,c,d,u,m;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=getApiKey()){e.next=5;break}return showNotification("Please add your Gemini API key in the settings","error"),toggleSettingsDropdown(),e.abrupt("return");case 5:return showLoading("Translating and summarizing..."),e.prev=6,e.next=9,getEmailContent();case 9:n=e.sent,r=Office.context.mailbox.item.subject,a="English",o=DEFAULT_TEMPLATES.translateSummarize;try{(i=localStorage.getItem("my_sidekick_michael_settings"))&&((s=JSON.parse(i)).templates&&s.templates.translateSummarize&&(o=s.templates.translateSummarize),s.language&&(a=s.language))}catch(e){console.error("Error getting template:",e)}l=o.replace("{subject}",r).replace("{content}",n).replace("{language}",a),c=!0;try{(d=localStorage.getItem("my_sidekick_michael_settings"))&&(u=JSON.parse(d)).tldrMode&&(c="true"===u.tldrMode)}catch(e){console.error("Error getting TLDR mode setting:",e)}if(!c){e.next=30;break}return e.next=20,generateTldrContent(l,t);case 20:return m=e.sent,hideLoading(),showResults(m,TYPES.TRANSLATE_SUMMARIZE),e.next=25,generateContent(l,t);case 25:updateResults(e.sent),updateExpandButton(!0),e.next=34;break;case 30:return e.next=32,generateContent(l,t);case 32:showResults(e.sent,TYPES.TRANSLATE_SUMMARIZE);case 34:e.next=39;break;case 36:e.prev=36,e.t0=e.catch(6),showNotification("Error: ".concat(e.t0.message),"error");case 39:case"end":return e.stop()}}),e,null,[[6,36]])})))).apply(this,arguments)}function showLoading(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Loading...";document.getElementById("loading").style.display="block",document.getElementById("loading-message").textContent=e,document.getElementById("landing-screen").style.display="none",document.getElementById("result-section").style.display="none"}function hideLoading(){var e=document.getElementById("loading");e&&(e.style.display="none")}function showResults(e,t){document.getElementById("result-content").innerHTML="",document.getElementById("tldr-content").innerHTML="";var n=document.getElementById("expand-content");n&&(n.disabled=!0,n.classList.add("ms-Button--disabled"),n.innerHTML='<span class="ms-Button-label">Show Full Content</span>',n.classList.remove("ms-Button--primary")),document.getElementById("loading").style.display="none",document.getElementById("result-section").style.display="block",document.getElementById("landing-screen").style.display="none",document.getElementById("app-body").style.display="block";var r=!0;try{var a=localStorage.getItem("my_sidekick_michael_settings");if(a){var o=JSON.parse(a);o.tldrMode&&(r="true"===o.tldrMode)}}catch(e){console.error("Error getting TLDR mode setting:",e)}if(r){document.getElementById("tldr-content").innerHTML=marked.parse(e);var i=document.getElementById("expand-content");i&&(i.disabled=!0,i.classList.add("ms-Button--disabled"),i.innerHTML='<span class="ms-Button-label">Loading Full Content...</span>')}else{document.getElementById("tldr-content").innerHTML=marked.parse(e);var s=document.getElementById("result-content");s||((s=document.createElement("div")).id="result-content",document.getElementById("full-content-container").appendChild(s)),s.innerHTML=marked.parse(e),document.getElementById("full-content-container").style.display="block";var l=document.getElementById("expand-content");l&&(l.disabled=!1,l.classList.remove("ms-Button--disabled"),l.innerHTML='<span class="ms-Button-label">Show Full Content</span>',l.classList.add("ms-Button--primary"))}var c=document.getElementById("copy-reply");c&&(c.style.display=t===TYPES.REPLY?"inline-block":"none");var d=document.getElementById("copy-result");d&&(d.style.display=t===TYPES.REPLY?"none":"inline-block");var u=document.getElementById("generate-reply");if(u){var m=localStorage.getItem("my_sidekick_michael_settings")&&"true"===JSON.parse(localStorage.getItem("my_sidekick_michael_settings")).showReply;u.style.display=t===TYPES.REPLY?"none":m?"inline-block":"none"}try{var p=localStorage.getItem("my_sidekick_michael_settings");if(p){var g=JSON.parse(p);g.fontSize&&applyFontSize(g.fontSize),g.showReply&&updateReplyButtonVisibility("true"===g.showReply)}}catch(e){console.error("Error applying font size:",e)}var y=document.getElementById("result-content"),h=document.getElementById("tldr-content");y&&(y.scrollTop=0),h&&(h.scrollTop=0)}function updateResults(e){var t=document.getElementById("expand-content");t&&(t.disabled=!1,t.classList.remove("ms-Button--disabled"),t.innerHTML='<span class="ms-Button-label">Show Full Content</span>');var n=document.getElementById("loading-container");n&&n.remove();var r=document.getElementById("result-content");r&&(r.innerHTML=marked.parse(e))}function resetUI(){document.getElementById("loading").style.display="none",document.getElementById("result-section").style.display="none",document.getElementById("landing-screen").style.display="block"}function updateReplyButtonVisibility(e){var t=document.getElementById("generate-reply");t&&(t.style.display=e?"inline-block":"none")}function expandContent(){var e=document.getElementById("expand-content");if(!e.disabled){var t=document.getElementById("full-content-container");"none"===t.style.display?(t.style.display="block",e.innerHTML='<span class="ms-Button-label">Hide Full Content</span>',e.classList.remove("ms-Button--primary")):(t.style.display="none",e.innerHTML='<span class="ms-Button-label">Show Full Content</span>',e.classList.add("ms-Button--primary"))}}function formatReplyOutput(e){var t="",n="",r=e.match(/^(?:SUBJECT:|Subject:)\s*(.+?)(?:\n|$)/m);if(r)t=r[1].trim(),n=e.replace(/^(?:SUBJECT:|Subject:)\s*.+?\n+/m,"").trim();else{var a=e.trim().split("\n");a.length>0?(t=a[0].trim(),n=a.slice(1).join("\n").trim()):(t="Re: Your email",n=e.trim())}return{html:'\n    <div class="reply-container">\n      <div class="reply-subject">\n        <span class="reply-label">Subject:</span>'.concat(t,'\n      </div>\n      <div class="reply-body">').concat(n,"</div>\n    </div>\n  "),subject:t,body:n,raw:"Subject: ".concat(t,"\n\n").concat(n)}}function generateReply(){return _generateReply.apply(this,arguments)}function _generateReply(){return(_generateReply=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,n,r,a,o,i,s,l,c,d,u,m,p;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=getApiKey()){e.next=5;break}return showNotification("Please add your Gemini API key in the settings","error"),toggleSettingsDropdown(),e.abrupt("return");case 5:return showLoading("Generating reply..."),e.prev=6,e.next=9,getEmailContent();case 9:n=e.sent,r=Office.context.mailbox.item.subject,a=DEFAULT_TEMPLATES.reply;try{(o=localStorage.getItem("my_sidekick_michael_settings"))&&(i=JSON.parse(o)).templates&&i.templates.reply&&(a=i.templates.reply)}catch(e){console.error("Error getting reply template:",e)}s=getLanguage(),l=a.replace("{subject}",r).replace("{content}",n).replace("{language}",getLanguageText(s)),c=null;try{(d=localStorage.getItem("my_sidekick_michael_settings"))&&(u=JSON.parse(d)).replyModel&&(c=u.replyModel)}catch(e){console.error("Error getting reply model:",e)}return e.next=19,generateContent(l,t,c);case 19:m=e.sent,p=formatReplyOutput(m),document.getElementById("tldr-content").innerHTML=p.html,document.getElementById("result-content").innerHTML=p.html,document.getElementById("result-section").style.display="block",document.getElementById("copy-reply").style.display="inline-block",document.getElementById("copy-result").style.display="none",e.next=31;break;case 28:e.prev=28,e.t0=e.catch(6),showNotification("Error: ".concat(e.t0.message),"error");case 31:return e.prev=31,hideLoading(),e.finish(31);case 34:case"end":return e.stop()}}),e,null,[[6,28,31,34]])})))).apply(this,arguments)}function copyReply(){var e=document.getElementById("tldr-content").innerText,t=e.match(/Subject:\s*(.+?)(?:\n|$)/i),n=t?t[1].trim():"",r=e.indexOf(n)+n.length,a=e.substring(r).trim(),o="Subject: ".concat(n,"\n\n").concat(a);navigator.clipboard.writeText(o).then((function(){var e=document.getElementById("copy-reply-status");e.textContent="Copied!",setTimeout((function(){e.textContent=""}),2e3)})).catch((function(e){console.error("Could not copy reply: ",e),showNotification("Failed to copy reply","error")}))}function extractTLDR(e){var t=e.match(/TL;DR:?\s*([^]*?)(?:\n\n|$)/i);if(t&&t[1])return t[1];var n=e.match(/Summary:?\s*([^]*?)(?:\n\n|$)/i);if(n&&n[1])return n[1];var r=e.split("\n\n")[0];return r&&r.length<300?r:r?r.substring(0,250)+"...":e.substring(0,200)+"..."}function initializeApp(){return _initializeApp.apply(this,arguments)}function _initializeApp(){return(_initializeApp=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,n,r,a;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=document.getElementById("settings-section"),n=document.getElementById("result-section"),r=document.getElementById("tldr-section"),t&&(t.style.display="none"),n&&(n.style.display="none"),r&&(r.style.display="none"),(a=loadSettings())&&(a.theme&&setTheme(a.theme),a.fontSize&&setFontSize(a.fontSize)),getApiKey()||showNotification("Please add your Gemini API key in settings","warning");case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function toggleSettings(){var e=document.getElementById("settings-section");"none"===e.style.display?e.style.display="block":e.style.display="none"}function saveApiKey(){var e=document.getElementById("api-key-input").value;localStorage.setItem("my_sidekick_michael_api_key",e),showNotification("API key saved successfully!","success"),toggleSettings()}function saveSettings(){var e={theme:document.getElementById("theme-select").value,fontSize:document.getElementById("font-size-select").value,apiKey:document.getElementById("api-key-input").value};localStorage.setItem("settings",JSON.stringify(e)),showNotification("Settings saved successfully!","success"),loadSettings()}function loadSettings(){try{var e=localStorage.getItem("michael_settings");if(e){var t=JSON.parse(e);Object.keys(t).forEach((function(e){var n=document.getElementById(e);n&&"SELECT"===n.tagName&&(n.value=t[e])}))}}catch(e){console.error("Error loading settings:",e)}}function getSetting(e){try{var t=localStorage.getItem("michael_settings");if(t)return JSON.parse(t)[e]}catch(t){console.error("Error getting setting ".concat(e,":"),t)}return null}function setTheme(e){var t=document.documentElement;"system"===e?window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?t.setAttribute("data-theme","dark"):t.setAttribute("data-theme","light"):t.setAttribute("data-theme",e)}function setFontSize(e){document.documentElement.style.setProperty("--result-font-size",getFontSizeValue(e))}function getFontSizeValue(e){switch(e){case"small":return"0.875rem";case"medium":default:return"1rem";case"large":return"1.125rem"}}function resetAllSettings(){document.getElementById("dropdown-model").value="gemini-1.5-flash",document.getElementById("dropdown-language").value="ko",document.getElementById("dropdown-event-title-language").value="en",document.getElementById("dropdown-theme").value="system",document.getElementById("dropdown-font-size").value="medium",document.getElementById("dropdown-tldr-mode").value="true",document.getElementById("dropdown-show-reply").value="true",document.getElementById("dropdown-reply-model").value="gemini-2.0-flash-lite",document.getElementById("dropdown-autorun").value="false",document.getElementById("dropdown-autorun-option").value="summarize",document.getElementById("dropdown-dev-mode").value="false",document.getElementById("dropdown-dev-server").value="",document.getElementById("dev-server-group").style.display="none",resetTemplates(),document.getElementById("dropdown-api-key").value="",localStorage.removeItem("michael_api_key"),localStorage.removeItem("michael_settings"),applyCurrentTheme(),applyFontSize("medium"),updateReplyButtonVisibility(!0),updateDevBadges(!1),showNotification("All settings reset to defaults","success")}function updateDevBadges(e){var t=document.getElementById("dev-badge"),n=document.getElementById("footer-dev-badge");t&&(t.style.display=e?"block":"none"),n&&(n.style.display=e?"block":"none")}function getEventTitleLanguage(){try{var e=localStorage.getItem("michael_settings");if(e){var t=JSON.parse(e);if(t.eventTitleLanguage)return t.eventTitleLanguage}return"en"}catch(e){return console.error("Error getting event title language:",e),"en"}}function parseEventDetailsWithGemini(e){return _parseEventDetailsWithGemini.apply(this,arguments)}function _parseEventDetailsWithGemini(){return(_parseEventDetailsWithGemini=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var n,r,a,o,i,s,l,c,d,u,m;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,n=getApiKey()){e.next=4;break}throw new Error("API key not found");case 4:return r=getEventTitleLanguage(),"",a="en"===r?"Event title should be in English.\n      If the event has a type or category, include it in square brackets ([]) at the beginning, then if there's a presenter and topic, write the presenter's name first, followed by a hyphen (-) and then the topic.":"ko"===r?"이벤트 제목은 한국어로 작성해주세요.\n      이벤트 유형이나 카테고리가 있다면 대괄호([])로 먼저 표시하고, 발표자와 주제가 있다면 발표자 이름을 먼저 쓰고 하이픈(-) 후에 주제를 적어주세요.":"ja"===r?"イベントのタイトルは日本語で記載してください。\n      イベントのタイプやカテゴリがある場合は、角括弧（[]）で囲んで最初に表示し、発表者とトピックがある場合は、発表者の名前を最初に書き、ハイフン（-）の後にトピックを書いてください。":"zh_cn"===r?"事件标题应该用中文书写。\n      如果事件有类型或类别，请使用方括号（[]）将其括起来并放在开头，如果有演讲者和主题，请先写演讲者的名字，然后是连字符（-），再写主题。":"Event title should be in ".concat(getLanguageText(r),".\n      If the event has a type or category, include it in square brackets ([]) at the beginning, then if there's a presenter and topic, write the presenter's name first, followed by a hyphen (-) and then the topic."),o="Analyze the following email content and extract information needed to create a calendar event for Microsoft Graph API.\n    The response must be in valid JSON format and follow the format below exactly.\n    Do not use escape characters that would cause parsing issues.\n    Mark any information that cannot be found as null.\n\n    ".concat(a,'\n\n    Event title format examples:\n    - "[Event Type] Presenter - Topic"\n    - "[Conference Name] Presenter Name - Presentation Topic"\n    - "[Seminar Type] Speaker Name - Presentation Title"\n\n    Required JSON format:\n    {\n      "subject": "Meeting title",\n      "body": {\n        "contentType": "HTML",\n        "content": "Meeting description"\n      },\n      "start": {\n        "dateTime": "YYYY-MM-DDTHH:mm:ss",\n        "timeZone": "Asia/Seoul"\n      },\n      "end": {\n        "dateTime": "YYYY-MM-DDTHH:mm:ss",\n        "timeZone": "Asia/Seoul"\n      },\n      "location": {\n        "displayName": "Location name"\n      },\n      "attendees": [\n        {\n          "emailAddress": {\n            "address": "attendee@email.com",\n            "name": "Attendee Name"\n          },\n          "type": "required"\n        }\n      ],\n      "isOnlineMeeting": true,\n      "onlineMeetingProvider": "teamsForBusiness"\n    }\n\n    Important notes:\n    1. Convert dates and times to ISO 8601 format (YYYY-MM-DDTHH:mm:ss)\n    2. Email addresses must be in valid format\n    3. Use "Asia/Seoul" as the default timezone\n    4. Set isOnlineMeeting to true if there are Teams links or video conference details\n    5. Process special characters properly to ensure valid JSON\n    6. Return only JSON without any additional explanations or comments\n\n    Email content:\n    ').concat(t),console.log("Sending prompt to Gemini API"),e.next=11,generateContent(o,n,null,!1);case 11:if(i=e.sent,console.log("Received response from Gemini API"),s=i,(l=i.match(/\{[\s\S]*\}/))&&(s=l[0]),console.log("Extracted JSON text:",s),e.prev=17,u=JSON.parse(s),console.log("Successfully parsed event details:",u),u.subject){e.next=22;break}throw new Error("Event title not found.");case 22:if(null!==(c=u.start)&&void 0!==c&&c.dateTime){e.next=24;break}throw new Error("Event start time not found.");case 24:if(null!==(d=u.end)&&void 0!==d&&d.dateTime){e.next=26;break}throw new Error("Event end time not found.");case 26:if((m=/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}$/).test(u.start.dateTime)){e.next=29;break}throw new Error("Invalid start time format. (Should be YYYY-MM-DDTHH:mm:ss format)");case 29:if(m.test(u.end.dateTime)){e.next=31;break}throw new Error("Invalid end time format. (Should be YYYY-MM-DDTHH:mm:ss format)");case 31:return e.abrupt("return",u);case 34:throw e.prev=34,e.t0=e.catch(17),console.error("JSON parsing error:",e.t0),console.error("Original response:",i),new Error("Failed to extract event information: "+e.t0.message);case 39:e.next=45;break;case 41:throw e.prev=41,e.t1=e.catch(0),console.error("Error extracting event information:",e.t1),e.t1;case 45:case"end":return e.stop()}}),e,null,[[0,41],[17,34]])})))).apply(this,arguments)}function createCalendarEvent(e){return _createCalendarEvent.apply(this,arguments)}function _createCalendarEvent(){return(_createCalendarEvent=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var n,r,a,o,i,s,l,c,d,u,m;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,t.subject&&null!==(n=t.start)&&void 0!==n&&n.dateTime&&null!==(r=t.end)&&void 0!==r&&r.dateTime){e.next=3;break}throw new Error("Required event information is missing.");case 3:return l=new Date(t.start.dateTime),c=new Date(t.end.dateTime),d=[],u=[],t.attendees&&t.attendees.length>0&&t.attendees.forEach((function(e){e.emailAddress&&e.emailAddress.address&&("optional"===e.type?u.push(e.emailAddress.address):d.push(e.emailAddress.address))})),m={requiredAttendees:d,optionalAttendees:u,start:l,end:c,location:(null===(a=t.location)||void 0===a?void 0:a.displayName)||"",body:(null===(o=t.body)||void 0===o?void 0:o.content)||"",subject:t.subject},console.log("Creating appointment with data:",JSON.stringify(m)),Office.context.mailbox.displayNewAppointmentForm({requiredAttendees:d,optionalAttendees:u,start:l,end:c,location:(null===(i=t.location)||void 0===i?void 0:i.displayName)||"",body:(null===(s=t.body)||void 0===s?void 0:s.content)||"",subject:t.subject}),showNotification("Event '".concat(t.subject,"' has been created."),"info"),e.abrupt("return",!0);case 15:throw e.prev=15,e.t0=e.catch(0),showNotification("Failed to create event: ".concat(e.t0.message),"error"),console.error("Error creating calendar event:",e.t0),e.t0;case 20:case"end":return e.stop()}}),e,null,[[0,15]])})))).apply(this,arguments)}function checkIfCalendarEvent(e){return _checkIfCalendarEvent.apply(this,arguments)}function _checkIfCalendarEvent(){return(_checkIfCalendarEvent=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var n,r,a;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,n=getApiKey()){e.next=5;break}return console.error("API key not found"),e.abrupt("return",!1);case 5:return r="Check if the following email content is a calendar event (meeting, appointment, schedule, etc.).\n    Return true if the email content includes one or more of the following:\n    - Date and time information\n    - Meeting-related keywords (meeting, conference, appointment, schedule, calendar, etc.)\n    - Attendee information\n    - Location information\n    - Schedule-related actions (attendance confirmation, add to calendar, etc.)\n\n    Email content:\n    ".concat(t,'\n\n    Your response must only contain "true" or "false".'),e.next=8,generateContent(r,n,null,!0);case 8:return a=e.sent,e.abrupt("return","true"===a.toLowerCase().trim());case 12:return e.prev=12,e.t0=e.catch(0),console.error("Error checking if calendar event:",e.t0),e.abrupt("return",!1);case 16:case"end":return e.stop()}}),e,null,[[0,12]])})))).apply(this,arguments)}function handleCalendarEvent(){return _handleCalendarEvent.apply(this,arguments)}function _handleCalendarEvent(){return(_handleCalendarEvent=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,n,r,a,o,i,s,l;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(getApiKey()){e.next=5;break}return showNotification("Please add your API key in settings","error"),toggleSettingsDropdown(),e.abrupt("return");case 5:return showLoading("Creating calendar event..."),e.prev=6,e.next=9,getEmailContent();case 9:return t=e.sent,document.getElementById("landing-screen").style.display="none",document.getElementById("result-section").style.display="block",document.getElementById("tldr-content").innerHTML='\n      <div class="email-content-header">\n        <h3>Email Content</h3>\n        <button id="copy-email-content" class="ms-Button ms-Button--primary">\n          <span class="ms-Button-label">Copy to Clipboard</span>\n        </button>\n      </div>\n      <div class="email-content-body">\n        <pre style="white-space: pre-wrap; word-break: break-word;">'.concat(t,"</pre>\n      </div>\n    "),document.getElementById("copy-email-content").addEventListener("click",(function(){navigator.clipboard.writeText(t).then((function(){showNotification("Email content copied to clipboard","info")})).catch((function(e){console.error("Error copying to clipboard:",e),showNotification("Failed to copy to clipboard","error")}))})),e.prev=14,e.next=17,parseEventDetailsWithGemini(t);case 17:return o=e.sent,document.getElementById("result-content").innerHTML='\n        <div class="event-details-header">\n          <h3>Extracted Event Details</h3>\n        </div>\n        <div class="event-details-body">\n          <p><strong>Subject:</strong> '.concat(o.subject||"Not found","</p>\n          <p><strong>Start:</strong> ").concat((null===(n=o.start)||void 0===n?void 0:n.dateTime)||"Not found","</p>\n          <p><strong>End:</strong> ").concat((null===(r=o.end)||void 0===r?void 0:r.dateTime)||"Not found","</p>\n          <p><strong>Location:</strong> ").concat((null===(a=o.location)||void 0===a?void 0:a.displayName)||"Not found","</p>\n        </div>\n      "),e.next=21,createCalendarEvent(o);case 21:e.next=30;break;case 23:e.prev=23,e.t0=e.catch(14),console.error("Event extraction error:",e.t0),i=e.t0.message,s=i.includes("Failed to extract event information:")?i.split("Failed to extract event information:")[1].trim():i,document.getElementById("result-content").innerHTML='\n        <div class="event-details-header">\n          <h3>Event Extraction Failed</h3>\n        </div>\n        <div class="event-details-body">\n          <p class="error-message">'.concat(s,"</p>\n        </div>\n      "),showNotification("Event extraction failed: ".concat(s),"error");case 30:e.next=36;break;case 32:e.prev=32,e.t1=e.catch(6),console.error("Calendar event handling error:",e.t1),showNotification("Error: ".concat(e.t1.message),"error");case 36:return e.prev=36,hideLoading(),updateCalendarButtonState(),(l=document.getElementById("expand-content"))&&(l.disabled=!1,l.classList.remove("ms-Button--disabled"),l.innerHTML='<span class="ms-Button-label">Show Full Content</span>',l.classList.add("ms-Button--primary"),document.getElementById("full-content-container").style.display="block"),e.finish(36);case 42:case"end":return e.stop()}}),e,null,[[6,32,36,42],[14,23]])})))).apply(this,arguments)}function updateCalendarButtonState(){return _updateCalendarButtonState.apply(this,arguments)}function _updateCalendarButtonState(){return(_updateCalendarButtonState=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,n,r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,getEmailContent();case 3:return t=e.sent,e.next=6,checkIfCalendarEvent(t);case 6:n=e.sent,(r=document.getElementById("calendar-event"))&&(n?(r.disabled=!1,r.classList.remove("action-button--disabled"),r.classList.add("action-button--primary"),console.log("Calendar event detected, button enabled")):(r.disabled=!0,r.classList.add("action-button--disabled"),r.classList.remove("action-button--primary"),console.log("Not a calendar event, button disabled"))),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),console.error("Error updating calendar button state:",e.t0);case 14:case"end":return e.stop()}}),e,null,[[0,11]])})))).apply(this,arguments)}function exportTemplatesAsMarkdown(){try{var e=localStorage.getItem("michael_settings"),t=e?JSON.parse(e):{},n=(localStorage.getItem("michael_api_key"),new Date),r=n.toISOString().slice(0,10),a="";try{if(Office.context.mailbox&&Office.context.mailbox.userProfile){var o=Office.context.mailbox.userProfile;a="\n\n*Exported by: ".concat(o.displayName," (").concat(o.emailAddress,")*")}}catch(e){console.log("User profile not available")}var i="# Michael Prompt Templates\n\n";i+="*Exported on: ".concat(n.toLocaleString(),"*").concat(a,"\n\n"),i+="## General Settings\n\n",i+="- **Model**: ".concat(t.model||"gemini-1.5-flash","\n"),i+="- **Reply Model**: ".concat(t.replyModel||"gemini-2.0-flash-lite","\n"),i+="- **Default Language**: ".concat(t.defaultLanguage||"ko","\n"),i+="- **Event Title Language**: ".concat(t.eventTitleLanguage||"en","\n\n"),i+="## Prompt Templates\n\n",i+="### Summarize Template\n\n```\n".concat(t.templates&&t.templates.summarize?t.templates.summarize:DEFAULT_TEMPLATES.summarize,"\n```\n\n"),i+="### Translate Template\n\n```\n".concat(t.templates&&t.templates.translate?t.templates.translate:DEFAULT_TEMPLATES.translate,"\n```\n\n"),i+="### Translate & Summarize Template\n\n```\n".concat(t.templates&&t.templates.translateSummarize?t.templates.translateSummarize:DEFAULT_TEMPLATES.translateSummarize,"\n```\n\n"),i+="### Reply Template\n\n```\n".concat(t.templates&&t.templates.reply?t.templates.reply:DEFAULT_TEMPLATES.reply,"\n```\n\n");var s=new Blob([i],{type:"text/markdown"}),l=URL.createObjectURL(s),c=document.createElement("a");c.href=l,c.download="michael-templates-".concat(r,".md"),document.body.appendChild(c),c.click(),setTimeout((function(){document.body.removeChild(c),URL.revokeObjectURL(l)}),100),showNotification("Templates exported successfully","success")}catch(e){console.error("Error exporting templates:",e),showNotification("Failed to export templates","error")}}Office.onReady((function(e){if(e.host===Office.HostType.Outlook){document.getElementById("sideload-msg").style.display="none",document.getElementById("app-body").style.display="flex",initializeApp();var t=!1,n=null;try{var r=localStorage.getItem("my_sidekick_michael_settings");if(r){var a=JSON.parse(r);t="true"===a.autorun,n=a.autorunOption}}catch(e){console.error("Error getting autorun settings:",e)}if(t&&n)switch(n){case"summarize":summarizeEmail();break;case"translate":translateEmail();break;case"translateAndSummarize":translateAndSummarizeEmail();break;case"reply":generateReply()}document.getElementById("summarize").addEventListener("click",summarizeEmail),document.getElementById("translate").addEventListener("click",translateEmail),document.getElementById("translate-summarize").addEventListener("click",translateAndSummarizeEmail),document.getElementById("calendar-event").addEventListener("click",handleCalendarEvent),document.getElementById("settings-toggle").addEventListener("click",toggleSettingsDropdown),document.getElementById("dropdown-close-settings").addEventListener("click",toggleSettingsDropdown),document.getElementById("dropdown-save-settings").addEventListener("click",saveDropdownSettings),document.getElementById("dropdown-reset-all").addEventListener("click",resetAllSettings),document.getElementById("dropdown-export-markdown").addEventListener("click",exportTemplatesAsMarkdown),document.getElementById("dropdown-api-key").addEventListener("keypress",(function(e){"Enter"===e.key&&saveDropdownSettings()})),document.getElementById("dropdown-dev-mode").addEventListener("change",(function(){document.getElementById("dev-server-group").style.display="true"===this.value?"block":"none"})),document.querySelectorAll(".settings-dropdown-container select").forEach((function(e){e.addEventListener("change",saveDropdownSettings)})),document.getElementById("expand-content").addEventListener("click",expandContent),document.getElementById("copy-result").addEventListener("click",copyResult),document.getElementById("generate-reply").addEventListener("click",generateReply),loadDropdownSettings(),applyCurrentTheme(),Office.context.mailbox.addHandlerAsync&&Office.context.mailbox.addHandlerAsync(Office.EventType.SettingsChanged,onSettingsChanged),Office.context.mailbox.addHandlerAsync(Office.EventType.ItemChanged,(function(e){var t=!1,n=null;try{var r=localStorage.getItem("my_sidekick_michael_settings");if(r){var a=JSON.parse(r);t="true"===a.autorun,n=a.autorunOption}}catch(e){console.error("Error getting autorun settings:",e)}if(t&&n)switch(n){case"summarize":summarizeEmail();break;case"translate":translateEmail();break;case"translateAndSummarize":translateAndSummarizeEmail();break;case"reply":generateReply()}}),(function(e){e.status===Office.AsyncResultStatus.Succeeded&&e.value.addHandlerAsync(Office.EventType.ItemChanged,(function(e){var t=!1,n=null;try{var r=localStorage.getItem("my_sidekick_michael_settings");if(r){var a=JSON.parse(r);t="true"===a.autorun,n=a.autorunOption}}catch(e){console.error("Error getting autorun settings:",e)}if(t&&n)switch(n){case"summarize":summarizeEmail();break;case"translate":translateEmail();break;case"translateAndSummarize":translateAndSummarizeEmail();break;case"reply":generateReply()}}),(function(e){e.status===Office.AsyncResultStatus.Succeeded&&e.value.register()}))})),Office.context.mailbox.addHandlerAsync(Office.EventType.ItemChanged,(function(e){updateCalendarButtonState()}),(function(e){e.status===Office.AsyncResultStatus.Succeeded&&e.value.addHandlerAsync(Office.EventType.ItemChanged,(function(e){updateCalendarButtonState()}))})),updateCalendarButtonState()}})),window.toggleSettingsDropdown=toggleSettingsDropdown;