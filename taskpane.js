/*! For license information please see taskpane.js.LICENSE.txt */
!function(){function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(){"use strict";t=function(){return r};var n,r={},o=Object.prototype,a=o.hasOwnProperty,i=Object.defineProperty||function(e,t,n){e[t]=n.value},l="function"==typeof Symbol?Symbol:{},s=l.iterator||"@@iterator",c=l.asyncIterator||"@@asyncIterator",d=l.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(n){u=function(e,t,n){return e[t]=n}}function m(e,t,n,r){var o=t&&t.prototype instanceof b?t:b,a=Object.create(o.prototype),l=new C(r||[]);return i(a,"_invoke",{value:z(e,n,l)}),a}function p(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}r.wrap=m;var y="suspendedStart",g="suspendedYield",h="executing",f="completed",v={};function b(){}function E(){}function w(){}var x={};u(x,s,(function(){return this}));var I=Object.getPrototypeOf,S=I&&I(I(_([])));S&&S!==o&&a.call(S,s)&&(x=S);var k=w.prototype=b.prototype=Object.create(x);function B(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function L(t,n){function r(o,i,l,s){var c=p(t[o],t,i);if("throw"!==c.type){var d=c.arg,u=d.value;return u&&"object"==e(u)&&a.call(u,"__await")?n.resolve(u.__await).then((function(e){r("next",e,l,s)}),(function(e){r("throw",e,l,s)})):n.resolve(u).then((function(e){d.value=e,l(d)}),(function(e){return r("throw",e,l,s)}))}s(c.arg)}var o;i(this,"_invoke",{value:function(e,t){function a(){return new n((function(n,o){r(e,t,n,o)}))}return o=o?o.then(a,a):a()}})}function z(e,t,r){var o=y;return function(a,i){if(o===h)throw Error("Generator is already running");if(o===f){if("throw"===a)throw i;return{value:n,done:!0}}for(r.method=a,r.arg=i;;){var l=r.delegate;if(l){var s=T(l,r);if(s){if(s===v)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===y)throw o=f,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=h;var c=p(e,t,r);if("normal"===c.type){if(o=r.done?f:g,c.arg===v)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(o=f,r.method="throw",r.arg=c.arg)}}}function T(e,t){var r=t.method,o=e.iterator[r];if(o===n)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=n,T(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),v;var a=p(o,e.iterator,t.arg);if("throw"===a.type)return t.method="throw",t.arg=a.arg,t.delegate=null,v;var i=a.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=n),t.delegate=null,v):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,v)}function O(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function j(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(O,this),this.reset(!0)}function _(t){if(t||""===t){var r=t[s];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function e(){for(;++o<t.length;)if(a.call(t,o))return e.value=t[o],e.done=!1,e;return e.value=n,e.done=!0,e};return i.next=i}}throw new TypeError(e(t)+" is not iterable")}return E.prototype=w,i(k,"constructor",{value:w,configurable:!0}),i(w,"constructor",{value:E,configurable:!0}),E.displayName=u(w,d,"GeneratorFunction"),r.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===E||"GeneratorFunction"===(t.displayName||t.name))},r.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,u(e,d,"GeneratorFunction")),e.prototype=Object.create(k),e},r.awrap=function(e){return{__await:e}},B(L.prototype),u(L.prototype,c,(function(){return this})),r.AsyncIterator=L,r.async=function(e,t,n,o,a){void 0===a&&(a=Promise);var i=new L(m(e,t,n,o),a);return r.isGeneratorFunction(t)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},B(k),u(k,d,"Generator"),u(k,s,(function(){return this})),u(k,"toString",(function(){return"[object Generator]"})),r.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},r.values=_,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(j),!e)for(var t in this)"t"===t.charAt(0)&&a.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=n)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,o){return l.type="throw",l.arg=e,t.next=r,o&&(t.method="next",t.arg=n),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],l=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var s=a.call(i,"catchLoc"),c=a.call(i,"finallyLoc");if(s&&c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&a.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,v):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),j(n),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;j(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:_(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=n),v}},r}function n(e,t,n,r,o,a,i){try{var l=e[a](i),s=l.value}catch(e){return void n(e)}l.done?t(s):Promise.resolve(s).then(r,o)}function r(e){return function(){var t=this,r=arguments;return new Promise((function(o,a){var i=e.apply(t,r);function l(e){n(i,o,a,l,s,"next",e)}function s(e){n(i,o,a,l,s,"throw",e)}l(void 0)}))}}var o="You are an expert researcher. Your task is to carefully review the provided research document and perform the following tasks:\n\n1. Summarize the Research Background:\nProvide a concise yet comprehensive summary of the research background, highlighting the context and motivation behind the study.\n\n2. Extract the Problem Statement:\nIdentify and articulate the central problem or challenge addressed by the research in clear and precise terms.\n\n3. Identify Strengths:\nList between three and five key strengths of the study. Focus on aspects such as methodology, innovation, robustness of results, or any other notable positive attributes.\n\n4. Identify Weaknesses:\nEnumerate between four and five significant weaknesses or limitations present in the research. Consider issues like methodological gaps, limited scope, or any areas lacking clarity.\n\n5. Propose Research Topics:\nBased on the weaknesses identified, suggest three potential research topics that could address these limitations or explore related areas further.\n\nEnsure your response is thorough and balanced, with academical depth and varied sentence structures that reflect both detailed insight and succinct clarity.\n\nSubject: {subject}\n\nContent:\n{content}";function a(){var e=document.getElementById("settings-dropdown");"none"===e.style.display?(e.style.display="block",u()):e.style.display="none"}function i(){var e=localStorage.getItem("theme")||"dark";if("light"===e)document.body.setAttribute("data-theme","light"),document.body.classList.remove("dark-theme");else if("dark"===e)document.body.setAttribute("data-theme","dark"),document.body.classList.add("dark-theme");else if(Office.context.officeTheme){var t=Office.context.officeTheme.bodyBackgroundColor;t&&!function(e){if(!e||"string"!=typeof e)return!1;try{e=e.replace("#","");var t=parseInt(e.substr(0,2),16),n=parseInt(e.substr(2,2),16),r=parseInt(e.substr(4,2),16);return!(isNaN(t)||isNaN(n)||isNaN(r))&&.299*t+.587*n+.114*r<128}catch(e){return console.error("Error calculating theme brightness:",e),!1}}(t)?(document.body.setAttribute("data-theme","light"),document.body.classList.remove("dark-theme")):(document.body.setAttribute("data-theme","dark"),document.body.classList.add("dark-theme"))}}function l(e){"system"===(localStorage.getItem("theme")||"system")&&i()}function s(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",n=document.getElementById("notification");n||((n=document.createElement("div")).id="notification",document.body.appendChild(n)),n.className="notification ".concat(t),n.textContent=e,n.style.display="block",setTimeout((function(){n.style.display="none"}),3e3)}function c(){var e={};try{var t=localStorage.getItem("readmedarling_settings");t&&(e=JSON.parse(t))}catch(e){console.error("Error parsing settings:",e)}var n=document.getElementById("dropdown-api-key").value,r=document.getElementById("dropdown-model").value,o=document.getElementById("dropdown-language").value,l=document.getElementById("dropdown-theme").value,c=document.getElementById("dropdown-font-size").value,d=document.getElementById("dropdown-tldr-mode").value,u=document.getElementById("dropdown-show-reply").value,p=document.getElementById("dropdown-reply-model").value,y=document.getElementById("dropdown-summarize-template").value,g=document.getElementById("dropdown-translate-template").value,h=document.getElementById("dropdown-translate-summarize-template").value;e.apiKey=n,e.model=r,e.defaultLanguage=o,e.theme=l,e.fontSize=c,e.tldrMode=d,e.showReply=u,e.replyModel=p,e.templates||(e.templates={}),e.templates.summarize=y,e.templates.translate=g,e.templates.translateSummarize=h,localStorage.setItem("readmedarling_settings",JSON.stringify(e)),localStorage.setItem("theme",l),i(),m(c),k("true"===u),s("All settings saved successfully"),a()}function d(){document.getElementById("dropdown-summarize-template").value=o,document.getElementById("dropdown-translate-template").value="You are an expert translator and interpreter with extensive proficiency in various languages, specializing in translating texts into polished, academic Korean. Your task is to translate the provided text from the source language into Korean, ensuring that every nuance, stylistic detail, and analytical aspect is accurately and naturally conveyed. Please follow these guidelines:\n\nPreserve Nuance and Style:\n- Accurately reflect the original text's tone, emotional nuance, and stylistic characteristics in Korean.\n- Adapt idiomatic expressions, metaphors, and culturally specific references to ensure they resonate with Korean readers.\n\nMaintain Analytical Precision:\n- Carefully dissect complex sentences and ideas, ensuring that your translation maintains the original text's logical flow and depth of analysis.\n- Where necessary, integrate brief annotations or contextual clarifications to help convey any cultural or conceptual subtleties.\n\nEnsure Accuracy and Consistency:\n- Translate specialized vocabulary, technical terms, and academic language with precision and maintain consistency throughout the text.\n- Verify that the structure and argumentative progression of the source material are preserved in the Korean version.\n\nUphold Contextual Integrity:\n- Ensure that the overall message and intent of the original text are fully maintained in your translation.\n- Make sure that transitions between ideas and sections remain coherent and logically connected in Korean.\n\nReview and Refine:\n- Reassess your translation for any potential ambiguities or loss of nuance, refining as necessary to enhance clarity and precision.\n- Strive for a balanced outcome that honors the original text while ensuring the translation is engaging and accessible to a Korean audience.\n\nDeliver your final translation in refined, academic Korean that faithfully embodies the original text's analytical and stylistic essence.\n\nSubject: {subject}\n\nContent:\n{content}",document.getElementById("dropdown-translate-summarize-template")&&(document.getElementById("dropdown-translate-summarize-template").value="You are an expert translator and summarizer with extensive proficiency in various languages, specializing in translating texts into polished, academic Korean. Your task is to translate the provided text from the source language into Korean AND create a concise summary of the main points. Please follow these guidelines:\n\nTranslation Aspects:\n- Accurately reflect the original text's tone, emotional nuance, and stylistic characteristics in Korean.\n- Adapt idiomatic expressions, metaphors, and culturally specific references to ensure they resonate with Korean readers.\n- Maintain analytical precision and logical flow in the Korean translation.\n\nSummarization Requirements:\n- Create a concise and focused summary of the key points in Korean.\n- Prioritize clarity and brevity while maintaining the essential meaning.\n- Ensure the summary captures the main ideas, arguments, and conclusions.\n- Limit the summary to approximately 30-40% of the original length.\n\nFinal Delivery Format:\n1. First provide a concise summary section (제목: 요약)\n2. Then provide the full translation (제목: 전체 번역)\n\nSubject: {subject}\n\nContent:\n{content}"),s("Templates reset to defaults")}function u(){try{var e=localStorage.getItem("readmedarling_settings");if(e){var t=JSON.parse(e);t.apiKey&&(document.getElementById("dropdown-api-key").value=t.apiKey),t.model&&(document.getElementById("dropdown-model").value=t.model),t.defaultLanguage&&(document.getElementById("dropdown-language").value=t.defaultLanguage),t.theme&&(document.getElementById("dropdown-theme").value=t.theme),t.fontSize&&(document.getElementById("dropdown-font-size").value=t.fontSize),t.tldrMode&&(document.getElementById("dropdown-tldr-mode").value=t.tldrMode),t.showReply&&(document.getElementById("dropdown-show-reply").value=t.showReply),t.replyModel&&(document.getElementById("dropdown-reply-model").value=t.replyModel),t.fontSize&&m(t.fontSize),t.showReply&&k("true"===t.showReply),t.templates&&(t.templates.summarize&&(document.getElementById("dropdown-summarize-template").value=t.templates.summarize),t.templates.translate&&(document.getElementById("dropdown-translate-template").value=t.templates.translate),t.templates.translateSummarize&&(document.getElementById("dropdown-translate-summarize-template").value=t.templates.translateSummarize))}else d()}catch(e){console.error("Error loading dropdown settings:",e),d()}}function m(e){document.documentElement.setAttribute("data-font-size",e||"medium")}function p(){return y.apply(this,arguments)}function y(){return(y=r(t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,t){Office.context.mailbox.item.body.getAsync("text",(function(n){n.status===Office.AsyncResultStatus.Succeeded?e(n.value):t(new Error("Failed to get email content"))}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e,t){return h.apply(this,arguments)}function h(){return h=r(t().mark((function e(n,r){var o,a,i,l,s,c,d,u,m,p=arguments;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a="gemini-1.5-flash",o=p.length>2&&void 0!==p[2]?p[2]:null)a=o;else try{(i=localStorage.getItem("readmedarling_settings"))&&(l=JSON.parse(i)).model&&(a=l.model)}catch(e){console.error("Error getting model from settings:",e)}return s="https://generativelanguage.googleapis.com/v1beta/models/".concat(a,":generateContent?key=").concat(r),e.prev=4,e.next=7,fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:n}]}],generationConfig:{temperature:.4,topK:32,topP:.95,maxOutputTokens:8192}})});case 7:return c=e.sent,e.next=10,c.json();case 10:if(d=e.sent,c.ok){e.next=13;break}throw new Error((null===(u=d.error)||void 0===u?void 0:u.message)||"Error generating content");case 13:if(d.candidates&&0!==d.candidates.length){e.next=15;break}throw new Error("No content generated");case 15:return m=d.candidates[0].content.parts[0].text,e.abrupt("return",m);case 19:throw e.prev=19,e.t0=e.catch(4),console.error("Error generating content:",e.t0),e.t0;case 23:case"end":return e.stop()}}),e,null,[[4,19]])}))),h.apply(this,arguments)}function f(){return localStorage.getItem("gemini_api_key")}function v(){return b.apply(this,arguments)}function b(){return(b=r(t().mark((function e(){var n,r,i,l,c,d,u;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=f()){e.next=5;break}return s("Please add your Gemini API key in the settings","error"),a(),e.abrupt("return");case 5:return x("Summarizing email..."),e.prev=6,e.next=9,p();case 9:r=e.sent,i=Office.context.mailbox.item.subject,l=o;try{(c=localStorage.getItem("readmedarling_settings"))&&(d=JSON.parse(c)).templates&&d.templates.summarize&&(l=d.templates.summarize)}catch(e){console.error("Error getting template:",e)}return u=l.replace("{subject}",i).replace("{content}",r),e.next=16,g(u,n);case 16:S(e.sent),e.next=23;break;case 20:e.prev=20,e.t0=e.catch(6),s("Error: ".concat(e.t0.message),"error");case 23:case"end":return e.stop()}}),e,null,[[6,20]])})))).apply(this,arguments)}function E(){var e="",t=document.getElementById("tldr-content").innerText,n=document.getElementById("result-content").innerText;if(t.includes("Subject:")||n.includes("Subject:")){var r="",o="",a=/^(?:Subject:\s*)?(.+?)(?:\n|$)/i.exec(t);a&&(r=a[1].trim()),o="none"!==document.getElementById("full-content-container").style.display?n:a?t.split("\n").slice(1).join("\n").trim():t,e="Subject: ".concat(r,"\n\n").concat(o)}else e="none"!==document.getElementById("full-content-container").style.display?n:t;navigator.clipboard.writeText(e).then((function(){var e=document.getElementById("copy-status");e.textContent="Copied!",setTimeout((function(){e.textContent=""}),2e3)})).catch((function(e){console.error("Could not copy text: ",e),s("Failed to copy to clipboard","error")}))}function w(e){if(!e)return"";var t="medium";try{var n=localStorage.getItem("readmedarling_settings");if(n){var r=JSON.parse(n);r.fontSize&&(t=r.fontSize)}}catch(e){console.error("Error getting font size:",e)}var o="small"===t?"13px":"large"===t?"18px":"16px",a="small"===t?"1.5":"large"===t?"1.7":"1.6",i="small"===t?"13px":"large"===t?"17px":"15px",l=/^#\s+(?:Re:|Subject:|\[Reply\]|Response:)/i.test(e);return e.replace(/^#\s+(.*$)/gim,(function(e,t){return l?'<h1 class="reply-heading">'.concat(t,"</h1>"):"<h1>".concat(t,"</h1>")})).replace(/^###\s+(.*$)/gim,"<h3>$1</h3>").replace(/^##\s+(.*$)/gim,"<h2>$1</h2>").replace(/\*\*(.*?)\*\*/gim,'<strong style="font-weight: 700;">$1</strong>').replace(/\*(.*?)\*/gim,'<em style="font-style: italic;">$1</em>').replace(/\_\_([^_]+)\_\_/gim,'<strong style="font-weight: 700;">$1</strong>').replace(/\_([^_]+)\_/gim,'<em style="font-style: italic;">$1</em>').replace(/^\s*\n\* (.*)/gim,'<ul class="no-indent">\n<li>$1</li>').replace(/^\* (.*)/gim,"<li>$1</li>").replace(/^\s*\n\d+\. (.*)/gim,'<ol class="no-indent">\n<li>$1</li>').replace(/^\d+\. (.*)/gim,"<li>$1</li>").replace(/^\> (.*$)/gim,'<blockquote style="border-left: 4px solid var(--accent-color); padding-left: 1em; margin: 1em 0; background-color: rgba(0,0,0,0.03);">$1</blockquote>').replace(/```([\s\S]*?)```/gim,'<pre style="background-color: var(--code-background); padding: 12px; border-radius: 5px; overflow-x: auto; border: 1px solid var(--border-color);"><code style="font-family: \'Courier New\', Courier, monospace; font-size: '+i+';">$1</code></pre>').replace(/`([^`]+)`/gim,"<code style=\"background-color: var(--code-background); padding: 3px 5px; border-radius: 3px; font-family: 'Courier New', Courier, monospace; font-size: "+i+'; font-weight: 500;">$1</code>').replace(/^\-\-\-$/gim,'<hr style="height: 2px; background-color: var(--border-color); border: 0; margin: 1.5em 0;">').replace(/\[([^\]]+)\]\(([^)]+)\)/gim,'<a href="$2" target="_blank" style="color: var(--accent-color); text-decoration: none; font-weight: bold;">$1</a>').replace(/\n\s*\n/gim,'</p><p style="margin: 0.8em 0; font-size: '+o+"; line-height: "+a+';">').replace(/\n/gim,"<br>").replace(/^(.+)$/gim,'<p style="margin: 0.8em 0; font-size: '+o+"; line-height: "+a+';">$1</p>')}function x(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Loading...",t=document.getElementById("loading-container");if(!t){(t=document.createElement("div")).id="loading-container",t.className="loading-container";var n=document.createElement("div");n.className="loading-spinner";var r=document.createElement("div");r.id="loading-message",r.className="loading-message",t.appendChild(n),t.appendChild(r),document.body.appendChild(t)}document.getElementById("loading-message").textContent=e,t.style.display="flex"}function I(){var e=document.getElementById("loading-container");e&&(e.style.display="none")}function S(e){document.getElementById("loading").style.display="none",document.getElementById("landing-screen").style.display="none",document.getElementById("result-section").style.display="block";var t=!0;try{var n=localStorage.getItem("readmedarling_settings");if(n){var r=JSON.parse(n);r.tldrMode&&(t="true"===r.tldrMode)}}catch(e){console.error("Error getting TLDR mode setting:",e)}var o=function(e){var t=e.match(/TL;DR:?\s*([^]*?)(?:\n\n|$)/i);if(t&&t[1])return t[1];var n=e.match(/Summary:?\s*([^]*?)(?:\n\n|$)/i);if(n&&n[1])return n[1];var r=e.split("\n\n")[0];return r&&r.length<300?r:r?r.substring(0,250)+"...":e.substring(0,200)+"..."}(e);document.getElementById("result-content").innerHTML=w(e),document.getElementById("tldr-content").innerHTML=w(o),t?(document.getElementById("full-content-container").style.display="none",document.getElementById("expand-content").innerHTML='<span class="ms-Button-label">Show Full Content</span>'):(document.getElementById("full-content-container").style.display="block",document.getElementById("expand-content").innerHTML='<span class="ms-Button-label">Hide Full Content</span>');try{var a=localStorage.getItem("readmedarling_settings");if(a){var i=JSON.parse(a);i.fontSize&&m(i.fontSize),i.showReply&&k("true"===i.showReply)}}catch(e){console.error("Error applying font size:",e)}document.getElementById("result-content").scrollTop=0,document.getElementById("tldr-content").scrollTop=0}function k(e){var t=document.getElementById("generate-reply-button");t&&(t.style.display=e?"inline-block":"none")}function B(){var e=document.getElementById("full-content-container"),t=document.getElementById("expand-content");"none"===e.style.display?(e.style.display="block",t.innerHTML='<span class="ms-Button-label">Hide Full Content</span>'):(e.style.display="none",t.innerHTML='<span class="ms-Button-label">Show Full Content</span>')}function L(e){var t="",n="",r=e.match(/^(?:SUBJECT:|Subject:)\s*(.+?)(?:\n|$)/m);if(r)t=r[1].trim(),n=e.replace(/^(?:SUBJECT:|Subject:)\s*.+?\n+/m,"").trim();else{var o=e.trim().split("\n");o.length>0?(t=o[0].trim(),n=o.slice(1).join("\n").trim()):(t="Re: Your email",n=e.trim())}return{html:'\n    <div class="reply-container">\n      <div class="reply-subject">\n        <span class="reply-label">Subject:</span>'.concat(t,'\n      </div>\n      <div class="reply-body">').concat(n,"</div>\n    </div>\n  "),subject:t,body:n,raw:"Subject: ".concat(t,"\n\n").concat(n)}}function z(){return T.apply(this,arguments)}function T(){return(T=r(t().mark((function e(){var n,r,o,i,l,c,d,u,m;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=f()){e.next=5;break}return s("Please add your Gemini API key in the settings","error"),a(),e.abrupt("return");case 5:x("Generating reply..."),e.prev=6,r="gemini-2.0-flash-light";try{(o=localStorage.getItem("readmedarling_settings"))&&(i=JSON.parse(o)).replyModel&&(r=i.replyModel)}catch(e){console.error("Error getting reply model setting:",e)}return e.next=11,p();case 11:return l=e.sent,c=Office.context.mailbox.item.subject,d='You are a professional email composer. Based on the following email content,\n    draft a concise, professional reply. The reply MUST include:\n\n    1. Start with "SUBJECT: " followed by an appropriate subject line, then a blank line\n    2. A professional, concise email body\n\n    Make the response clear, helpful, and to the point. Use a professional tone.\n\n    Email content to reply to:\n    Subject: '.concat(c,"\n\n    ").concat(l),e.next=16,g(d,n,r);case 16:u=e.sent,m=L(u),document.getElementById("tldr-content").innerHTML=m.html,document.getElementById("result-content").innerHTML=m.html,document.getElementById("result-section").style.display="block",document.getElementById("copy-reply-button").style.display="inline-block",document.getElementById("copy-result-button").style.display="none",I(),e.next=30;break;case 26:e.prev=26,e.t0=e.catch(6),I(),s("Error: ".concat(e.t0.message),"error");case 30:case"end":return e.stop()}}),e,null,[[6,26]])})))).apply(this,arguments)}function O(){var e=document.getElementById("tldr-content").innerText,t=e.match(/Subject:\s*(.+?)(?:\n|$)/i),n=t?t[1].trim():"",r=e.indexOf(n)+n.length,o=e.substring(r).trim(),a="Subject: ".concat(n,"\n\n").concat(o);navigator.clipboard.writeText(a).then((function(){var e=document.getElementById("copy-reply-status");e.textContent="Copied!",setTimeout((function(){e.textContent=""}),2e3)})).catch((function(e){console.error("Could not copy reply: ",e),s("Failed to copy reply","error")}))}function j(){var e=document.getElementById("settings-section");"none"===e.style.display?e.style.display="block":e.style.display="none"}function C(){var e=document.getElementById("api-key-input").value.trim();e?(localStorage.setItem("gemini_api_key",e),s("API key saved successfully","success"),document.getElementById("settings-section").style.display="none"):s("Please enter a valid API key","error")}function _(){var e={};document.querySelectorAll(".settings-dropdown-container select").forEach((function(t){e[t.id]=t.value})),localStorage.setItem("readmedarling_settings",JSON.stringify(e)),e.theme&&A(e.theme),e.resultFontSize&&P(e.resultFontSize),s("Settings saved","success")}function N(e){try{var t=localStorage.getItem("readmedarling_settings");if(t)return JSON.parse(t)[e]}catch(t){console.error("Error getting setting ".concat(e,":"),t)}return null}function A(e){var t=document.documentElement;"system"===e?window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?t.setAttribute("data-theme","dark"):t.setAttribute("data-theme","light"):t.setAttribute("data-theme",e)}function P(e){document.documentElement.style.setProperty("--result-font-size",function(e){switch(e){case"small":return"0.875rem";case"medium":default:return"1rem";case"large":return"1.125rem"}}(e))}Office.onReady((function(e){e.host===Office.HostType.Outlook&&(document.getElementById("sideload-msg").style.display="none",document.getElementById("app-body").style.display="flex",function(){try{var e=localStorage.getItem("readmedarling_settings");if(e){var t=JSON.parse(e);Object.keys(t).forEach((function(e){var n=document.getElementById(e);n&&"SELECT"===n.tagName&&(n.value=t[e])}))}}catch(e){console.error("Error loading settings:",e)}}(),f()||(document.getElementById("settings-section").style.display="block",s("Please set your Gemini API key in the settings","info")),A(N("theme")||"system"),P(N("resultFontSize")||"medium"),document.getElementById("summarize-button").addEventListener("click",v),document.getElementById("settings-button").addEventListener("click",j),document.getElementById("close-settings").addEventListener("click",j),document.getElementById("save-api-key").addEventListener("click",C),document.getElementById("api-key-input").addEventListener("keypress",(function(e){"Enter"===e.key&&C()})),document.querySelectorAll(".settings-dropdown-container select").forEach((function(e){e.addEventListener("change",_)})),document.getElementById("expand-button").addEventListener("click",(function(){var e=document.getElementById("full-content-container"),t=document.getElementById("expand-button");"none"===e.style.display?(e.style.display="block",t.querySelector(".ms-Button-label").textContent="Collapse"):(e.style.display="none",t.querySelector(".ms-Button-label").textContent="Expand")})),document.getElementById("copy-result-button").addEventListener("click",E),document.getElementById("copy-reply-button").addEventListener("click",O),document.getElementById("generate-reply-button").addEventListener("click",z),document.getElementById("dropdown-save-settings").onclick=c,document.getElementById("dropdown-close-settings").onclick=a,document.getElementById("dropdown-reset-templates").onclick=d,u(),i(),Office.context.mailbox.addHandlerAsync&&Office.context.mailbox.addHandlerAsync(Office.EventType.SettingsChanged,l),window.toggleSettingsDropdown=a,document.getElementById("expand-content").addEventListener("click",B))}))}();
//# sourceMappingURL=taskpane.js.map